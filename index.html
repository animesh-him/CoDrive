<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CoDrive</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Poppins,sans-serif;
  color:#fff;
  background:linear-gradient(270deg,#833ab4,#fd1d1d,#fcb045);
  background-size:600% 600%;
  animation:bg 15s ease infinite;
}
@keyframes bg{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
.container{max-width:520px;margin:auto;padding:16px}
.card{
  background:rgba(0,0,0,.35);
  backdrop-filter:blur(12px);
  border-radius:18px;
  padding:16px;
  margin-bottom:14px;
}
h1{font-family:Pacifico;font-size:42px;text-align:center;margin:6px 0}
.subtitle{text-align:center;font-size:14px;opacity:.9}
label{font-weight:600;margin-top:10px;display:block}
select,button{
  width:100%;
  margin-top:6px;
  padding:12px;
  border-radius:10px;
  border:none;
  font-size:14px;
}
select{background:rgba(255,255,255,.15);color:#fff}
select option{color:#000}
button{margin-top:14px;font-weight:600;cursor:pointer}
.tabs{display:flex;gap:8px;overflow-x:auto;margin-bottom:10px}
.tab{
  padding:6px 14px;
  border-radius:20px;
  background:rgba(255,255,255,.2);
  font-size:13px;
  cursor:pointer;
  white-space:nowrap;
}
.tab.active{background:#fff;color:#000}
.item{
  padding:10px 6px;
  border-bottom:1px solid rgba(255,255,255,.2);
  font-size:14px;
}
.footer{text-align:center;font-family:Pacifico;margin-top:10px}
</style>
</head>

<body>
<div class="container">

<h1>CoDrive</h1>
<div class="subtitle">Popular routes & time slots</div>

<div class="card">
  <label>From</label>
  <select id="from"></select>

  <label>To</label>
  <select id="to"></select>

  <label>Time Slot (15 min)</label>
  <select id="time"></select>

  <button onclick="showRoute()">Select Route</button>
</div>

<div class="card">
  <div class="tabs" id="tabs"></div>
  <div id="results">Select a route to see popularity</div>
</div>

<div class="footer">Created by Animesh</div>

</div>

<script>
const fromSel = document.getElementById("from");
const toSel = document.getElementById("to");
const timeSel = document.getElementById("time");
const results = document.getElementById("results");
const tabs = document.getElementById("tabs");

let selectedDate = today(0);
let DATA = {};

function today(offset){
  const d=new Date(); d.setDate(d.getDate()+offset);
  return d.toISOString().slice(0,10);
}

async function loadText(file,sel){
  const t=await fetch(file+"?t="+Date.now()).then(r=>r.text()).catch(()=> "");
  sel.innerHTML="";
  t.split("\n").filter(Boolean).forEach(v=>{
    const o=document.createElement("option");
    o.textContent=v.trim();
    sel.appendChild(o);
  });
}

function loadTimes(){
  for(let h=0;h<24;h++){
    for(let m=0;m<60;m+=15){
      const s=`${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`;
      const eM=m+15,eH=(h+Math.floor(eM/60))%24;
      const e=`${String(eH).padStart(2,"0")}:${String(eM%60).padStart(2,"0")}`;
      const o=document.createElement("option");
      o.textContent=`${s}-${e}`;
      timeSel.appendChild(o);
    }
  }
}

async function loadData(){
  DATA = await fetch("data.json?t="+Date.now())
    .then(r=>r.ok?r.json():{})
    .catch(()=>({}));
}

function loadTabs(){
  tabs.innerHTML="";
  for(let i=-5;i<=1;i++){
    const d=today(i);
    const t=document.createElement("div");
    t.className="tab"+(d===selectedDate?" active":"");
    t.textContent=d===today(0)?"Today":d;
    t.onclick=()=>{selectedDate=d;loadTabs();showRoute()};
    tabs.appendChild(t);
  }
}

function showRoute(){
  const key = `${fromSel.value} -> ${toSel.value}`;
  const dayData = DATA[selectedDate]?.[key];
  if(!dayData){results.innerHTML="<div class='item'>No data yet</div>";return;}

  const sorted = Object.entries(dayData)
    .sort((a,b)=>b[1]-a[1]);

  results.innerHTML="";
  sorted.forEach(([time,count])=>{
    const d=document.createElement("div");
    d.className="item";
    d.textContent=`${time}  â€¢  ${count} people`;
    results.appendChild(d);
  });
}

async function init(){
  await loadText("from_locations.txt",fromSel);
  await loadText("to_locations.txt",toSel);
  loadTimes();
  await loadData();
  loadTabs();
}
init();
setInterval(loadData,60000);
</script>

</body>
</html>
