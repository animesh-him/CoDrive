<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CoDrive</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#ff9800,#ff5722);
  color: #fff;
}
.container {
  padding: 16px;
  max-width: 500px;
  margin: auto;
}
h1 {
  text-align: center;
  font-family: cursive;
}
.toggle {
  display: flex;
  background: rgba(255,255,255,0.2);
  border-radius: 30px;
  overflow: hidden;
  margin-bottom: 16px;
}
.toggle button {
  flex: 1;
  padding: 10px;
  border: none;
  background: transparent;
  color: #fff;
  font-size: 16px;
}
.toggle button.active {
  background: #fff;
  color: #000;
}
select {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: none;
  margin-bottom: 12px;
  font-size: 15px;
}
.popularity {
  margin-top: 20px;
}
.row {
  display: flex;
  align-items: center;
  margin-bottom: 8px;
}
.row span {
  width: 140px;
  font-size: 14px;
}
.bar {
  flex: 1;
  height: 10px;
  background: rgba(255,255,255,0.3);
  border-radius: 10px;
  overflow: hidden;
}
.fill {
  height: 100%;
  background: #fff;
}
.counter {
  text-align: center;
  margin-top: 12px;
  font-size: 14px;
}
</style>
</head>

<body>
<div class="container">
  <h1>CoDrive</h1>

  <div class="toggle">
    <button id="todayBtn" class="active">Today</button>
    <button id="tomorrowBtn">Tomorrow</button>
  </div>

  <select id="from">
    <option value="">From location</option>
    <option>Brigade Eldorado Aerospace Park</option>
    <option>KARLE SEZ</option>
  </select>

  <select id="to">
    <option value="">To location</option>
    <option>KARLE SEZ</option>
    <option>Brigade Eldorado Aerospace Park</option>
  </select>

  <select id="timeSlot"></select>

  <div class="popularity">
    <h3>Popularity</h3>
    <div id="popList"></div>
  </div>

  <div class="counter">
    <span id="peopleCount">0</span> People finding their co-drive partner
  </div>
</div>

<script>
/* ---------- IST TIME ---------- */
function nowIST() {
  const now = new Date();
  const utc = now.getTime() + now.getTimezoneOffset() * 60000;
  return new Date(utc + 330 * 60000);
}

/* ---------- GLOBAL STATE ---------- */
let selectedDay = "today";

/* ---------- PEOPLE COUNTER ---------- */
let count = parseInt(localStorage.getItem("peopleCount") || "0", 10);
count++;
localStorage.setItem("peopleCount", count);
document.getElementById("peopleCount").textContent = count;

/* ---------- DAY BUTTONS ---------- */
todayBtn.onclick = () => switchDay("today");
tomorrowBtn.onclick = () => switchDay("tomorrow");

function switchDay(day) {
  selectedDay = day;
  todayBtn.classList.toggle("active", day === "today");
  tomorrowBtn.classList.toggle("active", day === "tomorrow");
  buildSlots();
  buildPopularity();
}

/* ---------- SLOT BUILDER ---------- */
function buildSlots() {
  const sel = document.getElementById("timeSlot");
  sel.innerHTML = "";

  const now = nowIST();
  let startMinutes = 0;

  if (selectedDay === "today") {
    startMinutes = Math.floor((now.getHours() * 60 + now.getMinutes()) / 15) * 15;
  }

  for (let m = startMinutes; m < 1440; m += 15) {
    const h1 = String(Math.floor(m / 60)).padStart(2, "0");
    const m1 = String(m % 60).padStart(2, "0");
    const h2 = String(Math.floor((m + 15) / 60) % 24).padStart(2, "0");
    const m2 = String((m + 15) % 60).padStart(2, "0");

    const opt = document.createElement("option");
    opt.value = `${h1}:${m1}-${h2}:${m2}`;
    opt.textContent = opt.value;
    sel.appendChild(opt);
  }
}

/* ---------- POPULARITY ---------- */
function buildPopularity() {
  const pop = {};
  const key = `${selectedDay}_${from.value}_${to.value}`;

  const stored = JSON.parse(localStorage.getItem("popData") || "{}");

  if (!stored[key]) stored[key] = [];

  stored[key].forEach(t => {
    pop[t] = (pop[t] || 0) + 1;
  });

  const entries = Object.entries(pop).sort((a,b)=>b[1]-a[1]);
  const max = entries[0]?.[1] || 1;

  const list = document.getElementById("popList");
  list.innerHTML = "";

  entries.forEach(([time,count])=>{
    const row = document.createElement("div");
    row.className = "row";
    row.innerHTML = `
      <span>${time} (${count})</span>
      <div class="bar"><div class="fill" style="width:${(count/max)*100}%"></div></div>
    `;
    list.appendChild(row);
  });
}

/* ---------- SAVE SELECTION ---------- */
timeSlot.onchange = () => {
  if (!from.value || !to.value) return;

  const key = `${selectedDay}_${from.value}_${to.value}`;
  const stored = JSON.parse(localStorage.getItem("popData") || "{}");
  if (!stored[key]) stored[key] = [];
  stored[key].push(timeSlot.value);
  localStorage.setItem("popData", JSON.stringify(stored));
  buildPopularity();
};

/* ---------- AUTO REFRESH ---------- */
from.onchange = to.onchange = () => {
  buildSlots();
  buildPopularity();
};

buildSlots();
buildPopularity();
</script>
</body>
</html>
